<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/cursor.js - Quetzalcoatl</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.7.0/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Roboto:300">
    <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Inconsolata:400">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
        
	    <img alt="Quetzalcoatl" src="../assets/css/logo.png" style="max-height: 65%;" title="Quetzalcoatl">
        
            Quetzalcoatl
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs Version: <b>1.0.0</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/cursor", "classes/gestures", "classes/text", "classes/websocket", "modules/quetzalcoatl"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
    <h3>APIs</h3>
    <div id="sidebar">
        <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
            <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
            <li><a href="#modules" data-toggle="tab">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" placeholder="Type to filter APIs">
        </div>

        <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
            <div class="tab-pane active" id="classes">
                <ul id="api-classes" class="nav nav-list">
                    
                        <li><a href="../classes/cursor.html">cursor</a></li>
                    
                        <li><a href="../classes/gestures.html">gestures</a></li>
                    
                        <li><a href="../classes/text.html">text</a></li>
                    
                        <li><a href="../classes/websocket.html">websocket</a></li>
                    
                </ul>
            </div>

            <div class="tab-pane" id="modules">
                <ul id="api-modules" class="nav nav-list">
                    
                        <li><a href="../modules/quetzalcoatl.html">quetzalcoatl</a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</div>

        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <div class="page-header">
    <h1>js/cursor.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
/**
 * Provides the cursor class. The cursor is displayed on-screen as a pair of circles
 *
 * @class cursor
 */

/**
 * A handle to the canvas element that draws the cursor
 *
 * @property c
 * @type Object
 * @default document.getElementById(&quot;cursor&quot;)
 * @final
 */
var c = document.getElementById(&quot;cursor&quot;);
var ctx = c.getContext(&quot;2d&quot;);

/**
 * The radius of the cursor circle when the hand is in an &quot;open&quot; state
 *
 * @property open_radius
 * @type Number
 * @default 25
 * @final
 */
var open_radius = 25;

/**
 * The radius of the cursor circle when the hand is in a &quot;closed&quot; state.
 *
 * @property grab_radius
 * @type Number
 * @default 15.45
 * @final
 */
var grab_radius = open_radius / 1.618;

/**
 * The radius of the cursor circle when the hand is in a &quot;pointing/lasso&quot; state.
 *
 * @property point_radius
 * @type Number
 * @default 9.55
 * @final
 */
var point_radius = grab_radius / 1.618;


/**
 * The color of the left hand cursor circle. This color is taken from the
 * 5-color palette from the Solarized color scheme.
 *
 * @property leftColor
 * @type String
 * @default &quot;#d33682&quot;
 * @final
 */
var leftColor = &quot;#d33682&quot;;

/**
 * The color of the right hand cursor circle. This color is taken from the
 * 5-color palette from the Solarized color scheme.
 *
 * @property rightColor
 * @type String
 * @default &quot;#6c71c4&quot;
 * @final
 */
var rightColor = &quot;#6c71c4&quot;;

/**
 * The dimensions of the user&#x27;s screen, which we call the screen viewport.
 *
 * @property scoord
 * @type Object
 * @final
 */
var scoord = {
    xmin: 0,
    xmax: window.innerWidth,
    ymin: 0,
    ymax: window.innerHeight
};

// Set the width and height of the canvas to be the size of the window
ctx.canvas.width = scoord.xmax - scoord.xmin;
ctx.canvas.height = scoord.ymax - scoord.ymin;


/**
 * Rounds a number such that it is a multiple of the provided number. This function
 * comes in handy for stabilizing cursor jitter (by rounding the mapped coordinates).
 *
 * @method stabilizer
 * @static
 * @param {Number} x A number to be rounded.
 * @param {Number} factor A number which represents a multiple to which x will be rounded.
 * @return {Number} A rounded number.
 *
 * @example
 *      stabilizer(92,6) = 96
 */
// An instance rounds a number to some multiple. This is used to stabilize the cursor jitter
// Input: (1) A number; (2) An integer multiple which (1) will be rounded to
// Output: A rounded number
function stabilizer(x, factor) {
    return x - (x % factor) + (x % factor &gt; 0 &amp;&amp; factor);
}

// An instance maps Kinect coordinates to Screen coordinates
// Input: Array of float x and float y coordinates of the depth data from the Kinect
// and object literal of coordinates describing the user viewport
// Output: Array of Integer x and Integer y coordinates of the screen viewport
function mapCoordinates(arr, screenw, screenh, sx, sy, threshold) {
    // Coordinates of the user viewport. The bottom center of the user viewport is
    // centered at the user&#x27;s spine base
    var kcoord = {
        // The leftmost point is one arm length to the left of the spine base
        xmin: sx - screenw / 2,
        // The rightmost point is one arm length to the right of the spine base
        xmax: sx + screenw / 2,
        // The topmost point is the spine base minus the user height
        ymin: sy - screenh,
        // The bottommost point is the spine base
        ymax: sy
    };

    var x = null,
        y = null;

    // Calculate the coordinate space for the incoming x-coordinate
    if (arr[0] &lt; kcoord.xmin) {
        // If the hand is too far to the left, clip to the left edge of the screen
        x = 0;
    } else if (arr[0] &gt; kcoord.xmax) {
        // If the hand is too far to the right, clip to the right edge of the screen
        x = window.innerWidth;
    } else {
        // Otherwise, translate it so it fits within the viable space
        x = (arr[0] - kcoord.xmin) / (kcoord.xmax - kcoord.xmin) * (scoord.xmax - scoord.xmin);
    }

    // Calculate the coordinate space for the incoming y-coordinate
    if (arr[1] &lt; kcoord.ymin) {
        // If the hand is too high up, clip it to the top edge of the screen
        y = 0;
    } else if (arr[1] &gt; kcoord.ymax) {
        // If the hand is too low down, clip it to the bottom edge of the screen
        y = window.innerHeight;
    } else {
        // Otherwise, translate it so it fits within the viable space
        y = (arr[1] - kcoord.ymin) / (kcoord.ymax - kcoord.ymin) * (scoord.ymax - scoord.ymin);
    }

    // Threshold the result to minimize jitter
    var xcoord = stabilizer(x, threshold * window.innerWidth),
        ycoord = stabilizer(y, threshold * window.innerHeight);

    return [xcoord, ycoord];
}

// An instance updates the console on the bottom right of the screen with cursor coordinates
// Input: Array of float x and float y mapped coordinates
// Output: Unit
function updateConsole(lcoord, lhandState, rcoord, rhandState) {
    // Initialize handlers for the screen coordinates in the console
    var lscreenx = document.getElementById(&quot;lscreenx&quot;),
        lscreeny = document.getElementById(&quot;lscreeny&quot;),
        rscreenx = document.getElementById(&quot;rscreenx&quot;),
        rscreeny = document.getElementById(&quot;rscreeny&quot;);

    // Initialize handlers for the hand states in the console
    var lstate = document.getElementById(&quot;lhstate&quot;),
        rstate = document.getElementById(&quot;rhstate&quot;);

    // Write the screen coordinates
    lscreenx.innerText = lcoord[0] + &quot;/&quot; + window.innerWidth;
    lscreeny.innerText = lcoord[1] + &quot;/&quot; + window.innerHeight;

    rscreenx.innerText = rcoord[0] + &quot;/&quot; + window.innerWidth;
    rscreeny.innerText = rcoord[1] + &quot;/&quot; + window.innerHeight;

    // Write the hand states
    lstate.innerText = lhandState;
    rstate.innerText = rhandState;
}

// An instance sums the values corresponding to object keys in an array of objects
// Precondition: Assumes the value at each key is a number (integer/float)
// Input: (1) Array of object literals; (2) Valid key referenced in object literal
// Output: Sum of values
function sumIter(arr, key) {
    var result = 0;

    // Go through every element in the array and add its value to the result
    arr.forEach(function(entry) {
        result += entry[key];
    });

    return result;
}

// An instance counts the number of occurrences of each hand state and returns the
// state with the highest frequency of occurrence
// Precondition: Assumes that the value at the key provided is a valid hand state
// Input: (1) Array of object literals; (2) Valid key referenced in object literal
// Output: Hand state
function selectState(arr, key) {
    // Initialize counters for each hand state
    var openCount = 0,
        closedCount = 0,
        pointCount = 0,
        unknownCount = 0;

    // Go through the list and count the number of occurrences of each hand state
    arr.forEach(function(entry) {
        switch (entry[key]) {
            case &quot;open&quot;:
                openCount++;
                break;
            case &quot;closed&quot;:
                closedCount++;
                break;
            case &quot;point&quot;:
                pointCount++;
                break;
            case &quot;unknown&quot;:
                unknownCount++;
                break;
            default:
                break;
        }
    });

    // Return the state with the highest occurrence
    if (openCount &gt; closedCount &amp;&amp; openCount &gt; pointCount &amp;&amp; openCount &gt; unknownCount) {
        return &quot;open&quot;;
    } else if (closedCount &gt; pointCount &amp;&amp; closedCount &gt; unknownCount) {
        return &quot;closed&quot;;
    } else if (pointCount &gt; unknownCount) {
        return &quot;point&quot;;
    } else {
        return &quot;unknown&quot;;
    }
}

// An instance looks up a precision threshold value for the hand state
function cursorThreshold(state) {
    if (state === &quot;point&quot;) {
        return 1 / 100;
    } else {
        return 1 / 50;
    }
}

// An instance averages coordinate input across the specified number of frames
// If more frames are requested than available, we use all available frames in the stack
// Input: (1) A stack of well-formed coordinate data; (2) Number of frames to be averaged
// Output: Object literal (JSON-formatted) of coordinates
function averageFrames(coordData, k) {
    // Initialize a temporary holder for the frame data
    var holdingArr = [];

    // Initialize temporary holders for the left and right hand states
    var avglhandstate = null,
        avgrhandstate = null;

    // Use all available frames in the stack if more frames are requested than available
    k = Math.min(coordData.length, k);

    // Pop all the required frames off the stack
    for (var i = 0; i &lt; k; i++) {
        holdingArr[i] = coordData[coordData.length - i - 1];
    }

    // If the current left hand state is unknown, average the states and return the result
    // Otherwise, return the hand state from the most recent frame
    if (coordData[coordData.length - 1].lhandState === &quot;unknown&quot;) {
        avglhandstate = selectState(holdingArr, &quot;lhandState&quot;);
    } else {
        avglhandstate = coordData[coordData.length - 1].lhandState;
    }

    // If the current right hand state is unknown, average the states and return the result
    // Otherwise, return the hand state from the most recent frame
    if (coordData[coordData.length - 1].rhandState === &quot;unknown&quot;) {
        avgrhandstate = selectState(holdingArr, &quot;rhandState&quot;);
    } else {
        avgrhandstate = coordData[coordData.length - 1].rhandState;
    }

    var averagedData = {
        lx: sumIter(holdingArr, &quot;lx&quot;) / k,
        ly: sumIter(holdingArr, &quot;ly&quot;) / k,
        rx: sumIter(holdingArr, &quot;rx&quot;) / k,
        ry: sumIter(holdingArr, &quot;ry&quot;) / k,
        sx: sumIter(holdingArr, &quot;sx&quot;) / k,
        sy: sumIter(holdingArr, &quot;sy&quot;) / k,
        lhandState: avglhandstate,
        rhandState: avgrhandstate
    };

    return averagedData;
}

// An instance assigns the appropriate radius depending on the hand state
// Input: A valid hand state
// Output: A float radius value
function assignRadius(state) {
    switch (state) {
        case &quot;open&quot;:
            return open_radius;
        case &quot;closed&quot;:
            return grab_radius;
        case &quot;point&quot;:
            return point_radius;
        default:
            return open_radius;
    }
}

// An instance redraws the cursor on the overlay layer
// Input: Array of float x and float y mapped coordinates
// Output: Unit
function reDraw(lcoord, lhandState, rcoord, rhandState) {
    // Initialize the radius of the cursor circle
    var lradius = assignRadius(lhandState),
        rradius = assignRadius(rhandState);

    // Clear the entire canvas
    // TODO: Only clear the part of the canvas that contains the old cursor circles
    // In addition, only do it on a per-hand basis, rather than for both circles
    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

    // Draw the cursors at their new location
    // Left Hand
    if (lhandState !== &quot;unknown&quot;) {
        ctx.beginPath();
        ctx.arc(lcoord[0], lcoord[1], lradius, 0, 2 * Math.PI);
        ctx.fillStyle = leftColor;
        ctx.fill();
        ctx.closePath();
    }

    // Right Hand
    if (rhandState !== &quot;unknown&quot;) {
        ctx.beginPath();
        ctx.arc(rcoord[0], rcoord[1], rradius, 0, 2 * Math.PI);
        ctx.fillStyle = rightColor;
        ctx.fill();
        ctx.closePath();
    }
}

// Write placeholder variables to the console
updateConsole([0, 0], &quot;N/A&quot;, [0, 0], &quot;N/A&quot;, window.innerWidth, window.innerHeight, window.innerWidth / 2, window.innerHeight);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
inlineMath: [ ['$','$'], ["\\(","\\)"] ],
displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
processEscapes: true
},
"HTML-CSS": { availableFonts: ["TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
